<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>NovaHunt.ai — Search Contacts</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>

  <!-- AOS Animations -->
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css"/>

  <style>
    :root {
      --purple-darkest: #0b0924;
      --purple-main: #3a2a7a;
      --purple-bright: #5a32d6;
      --purple-light: #8c6aff;
      --purple-soft: #d8ccff;

      --text-main: #ffffff;
      --text-muted: #cfc9ff;

      --radius-xl: 32px;
      --shadow-soft: 0 18px 45px rgba(10,14,40,0.45);
    }

    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; font-family: "Inter", sans-serif; }

    body {
      background: var(--purple-darkest);
      color: var(--text-main);
      overflow-x: hidden;
    }

    /* SIGN-IN BUTTON */
    #authLink {
      position: absolute;
      top: 24px;
      right: 28px;
      padding: 10px 20px;
      border-radius: 999px;
      background: rgba(255,255,255,0.12);
      border: 1px solid rgba(255,255,255,0.18);
      color: #fff;
      font-weight: 600;
      font-size: 14px;
      text-decoration: none;
      backdrop-filter: blur(6px);
      transition: background 0.25s ease;
      z-index: 9999;
    }
    #authLink:hover {
      background: rgba(255,255,255,0.22);
    }

    /* HERO */
    .hero {
      padding: 120px 20px 80px;
      background: linear-gradient(135deg, var(--purple-main), var(--purple-darkest));
      background-size: 200% 200%;
      animation: heroGradient 22s ease infinite;
      text-align: center;
    }

    @keyframes heroGradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .hero-brand {
      font-size: 48px;
      font-weight: 800;
      letter-spacing: -0.03em;
      margin-bottom: 12px;
    }

    .hero-sub {
      font-size: 20px;
      color: var(--text-muted);
      max-width: 720px;
      margin: 0 auto 40px auto;
      line-height: 1.55;
    }

    /* SEARCH MODULE */
    .search-module {
      max-width: 900px;
      margin: 0 auto;
      background: rgba(255,255,255,0.06);
      border-radius: var(--radius-xl);
      padding: 40px 32px;
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow-soft);
    }

    .input-icon-wrapper {
      position: relative;
      width: 100%;
    }

    .input-icon {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 20px;
      color: var(--purple-soft);
      pointer-events: none;
    }

    #domainInput {
      width: 100%;
      padding: 26px 26px 26px 60px;
      font-size: 20px;
      border-radius: 20px;
      border: 2px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.08);
      color: #fff;
      outline: none;
      transition: border-color 0.25s ease, box-shadow 0.25s ease;
    }

    #domainInput::placeholder {
      color: rgba(255,255,255,0.45);
    }

    #domainInput:focus {
      border-color: var(--purple-light);
      box-shadow: 0 0 0 3px rgba(140,106,255,0.25);
    }

    .actions-row {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      justify-content: center;
      margin-top: 20px;
    }

    .cta {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 14px 28px;
      border-radius: 999px;
      font-weight: 700;
      font-size: 16px;
      text-decoration: none;
      cursor: pointer;
      border: none;
      background: linear-gradient(135deg, var(--purple-bright), var(--purple-light));
      color: #fff;
      transition: transform 0.25s ease, box-shadow 0.25s ease;
    }

    .cta:hover {
      transform: translateY(-3px);
      box-shadow: 0 14px 40px rgba(90,50,214,0.45);
    }

    /* STATUS + CREDITS */
    #creditsBanner, #statusMsg {
      text-align: center;
      margin-top: 20px;
      font-size: 14px;
      color: var(--text-muted);
    }

    /* RESULTS WRAP — HIDDEN UNTIL RESULTS EXIST */
    .results-wrap {
      display: none;
      max-width: 900px;
      margin: 40px auto 0 auto;
      background: #ffffff;
      color: #111827;
      border-radius: var(--radius-xl);
      padding: 32px;
      box-shadow: 0 18px 45px rgba(10,14,40,0.25);
    }

    /* SKELETON LOADER */
    .skeleton-card {
      background: #f3f4f6;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
      overflow: hidden;
      position: relative;
    }

    .skeleton-bar {
      height: 14px;
      background: #e5e7eb;
      border-radius: 8px;
      margin-bottom: 12px;
      width: 100%;
    }

    .skeleton-bar.short { width: 40%; }
    .skeleton-bar.medium { width: 70%; }

    .shimmer {
      position: absolute;
      top: 0;
      left: -150px;
      height: 100%;
      width: 150px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
      animation: shimmerMove 1.4s infinite;
    }

    @keyframes shimmerMove {
      0% { left: -150px; }
      100% { left: 100%; }
    }

    /* TOAST */
    #toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.15);
      padding: 14px 26px;
      border-radius: 999px;
      color: #fff;
      font-weight: 600;
      font-size: 15px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.25);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
      z-index: 99999;
    }

    #toast.show {
      opacity: 1;
    }

    /* MOBILE FIX */
    @media (max-width: 640px) {
      .hero-brand { font-size: 36px; }
      .hero-sub { font-size: 16px; }

      @media (max-width: 640px) {
  #domainInput {
    font-size: 15px !important;
    padding-left: 44px !important;
    letter-spacing: 0 !important;
  }

  .input-icon {
    left: 12px !important;
    font-size: 17px !important;
  }
}

      .cta { font-size: 15px; padding: 12px 22px; }
      .results-wrap { padding: 20px; }
    }

    /* RESTORE ORIGINAL RESULT SPACING & STYLE */

/* Restore white container spacing */
.results-wrap {
  padding: 32px !important;
  margin-top: 40px !important;
  border-radius: 32px !important;
  background: #ffffff !important;
}

/* Restore department header spacing */
.dept-header {
  margin-top: 32px !important;
  margin-bottom: 12px !important;
  font-size: 20px !important;
  font-weight: 700 !important;
}

/* Restore card spacing */
.result-card {
  background: #f9fafb !important;
  border-radius: 16px !important;
  padding: 16px 20px !important;
  margin-bottom: 12px !important;
  box-shadow: 0 10px 30px rgba(15,23,42,.08) !important;
}

/* Restore text sizes */
.result-name {
  font-size: 16px !important;
  font-weight: 700 !important;
}

.result-role {
  font-size: 14px !important;
  color: #6b7280 !important;
}

.result-email {
  font-size: 14px !important;
  color: #111827 !important;
}

/* Restore button spacing */
.secondary-btn {
  margin-right: 8px !important;
  padding: 8px 14px !important;
  font-size: 13px !important;
}

    /* FIX: Department accordion behavior */
.dept-content {
  display: none;
  padding-left: 8px;
}

.dept-content.open {
  display: block;
}

/* Optional: restore original arrow spacing */
.dept-header {
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

    /* FIX: Restore department header alignment */
.dept-header {
  display: flex !important;
  align-items: center !important;
  justify-content: flex-start !important;
  gap: 10px !important; /* spacing between name, count, arrow */
  cursor: pointer;
}

/* Ensure the arrow sits right after the count */
.dept-arrow {
  margin-left: 4px !important;
}

/* Ensure the count isn't pushed to the middle */
.dept-count {
  margin-left: 6px !important;
}
  </style>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>

<!-- TOAST -->
<div id="toast">✓ See results below</div>

<!-- SIGN-IN BUTTON -->
<a id="authLink" href="/login.html">Sign In</a>

<!-- HERO -->
<section class="hero" data-aos="fade-up">
  <h1 class="hero-brand" data-aos="fade-up" data-aos-delay="100">NovaHunt.ai</h1>
  <p class="hero-sub" data-aos="fade-up" data-aos-delay="200">
    Search verified professional contacts by domain — fast, accurate, and beautifully simple.
  </p>

  <!-- SEARCH MODULE -->
  <div class="search-module" data-aos="fade-up" data-aos-delay="300">
    <form class="domain-form" id="searchForm">

      <div class="input-icon-wrapper">
        <span class="input-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="10" stroke="#8c6aff" stroke-width="2"/>
            <path d="M2 12h20" stroke="#8c6aff" stroke-width="2"/>
            <path d="M12 2c3 4 3 16 0 20" stroke="#8c6aff" stroke-width="2"/>
            <path d="M12 2c-3 4-3 16 0 20" stroke="#8c6aff" stroke-width="2"/>
          </svg>
        </span>

        <input id="domainInput" type="text" placeholder="Enter company domain" required />
      </div>

      <div class="actions-row">
        <button type="submit" class="cta">New Search</button>
        <a href="/plans.html" class="cta" id="plansButton">View Plans & Pricing</a>
        <a href="/account" class="cta" id="accountButton" style="display:none;">Go to Account</a>
        <a href="/plans.html" class="cta" id="upgradeButton" style="display:none;">Upgrade Plan</a>
      </div>

    </form>
  </div>
</section>

<!-- RESULTS SECTION -->
<div id="creditsBanner" style="display:none;"></div>
<div id="statusMsg"></div>

<div class="results-wrap" id="results"></div>

<!-- SHIMMER LOADER -->
<div id="shimmerLoader" style="display:none; max-width:900px; margin:40px auto 0 auto;">
  <div class="skeleton-card">
    <div class="skeleton-bar medium"></div>
    <div class="skeleton-bar short"></div>
    <div class="skeleton-bar"></div>
    <div class="skeleton-bar medium"></div>
    <div class="shimmer"></div>
  </div>
  <div class="skeleton-card">
    <div class="skeleton-bar medium"></div>
    <div class="skeleton-bar short"></div>
    <div class="skeleton-bar"></div>
    <div class="skeleton-bar medium"></div>
    <div class="shimmer"></div>
  </div>
  <div class="skeleton-card">
    <div class="skeleton-bar medium"></div>
    <div class="skeleton-bar short"></div>
    <div class="skeleton-bar"></div>
    <div class="skeleton-bar medium"></div>
    <div class="shimmer"></div>
  </div>
</div>

<button id="loadMoreBtn"
  style="
    display:none;
    margin: 30px auto;
    padding: 14px 26px;
    border-radius: 14px;
    background: #e5e7eb;
    border: none;
    font-weight: 600;
    cursor: pointer;
    font-size: 15px;
  ">
  Load More
</button>

<script>
const HUNTER_API_KEY = "b2eb114113547c1eeb296f358fb10653acc0727a";
const PAGE_SIZE = 100;

const client = window.supabase.createClient(
  'https://zusfblqrhqalgywcdvld.supabase.co',
  'sb_publishable_KVGRBPQZKqrhQomdahPBaQ_Yz2XXPx2'
);

let currentUser = null;
let currentMeta = null;
let offset = 0;
let totalResults = 0;
let currentDomain = '';

const deptOrder = [
  'Executive','Management','Marketing','Sales','Operations',
  'Design','Communication','Legal','Support','Department unknown'
];

function showToast() {
  const t = document.getElementById('toast');
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

async function refreshUser() {
  const { data } = await client.auth.getUser();
  const authLink = document.getElementById('authLink');

  if (!data.user) {
    currentUser = null;
    currentMeta = null;
    authLink.textContent = 'Sign In';
    authLink.href = '/login.html';

    document.getElementById('plansButton').style.display = 'inline-flex';
    document.getElementById('accountButton').style.display = 'none';
    document.getElementById('upgradeButton').style.display = 'none';
    document.getElementById('creditsBanner').style.display = 'none';
    return;
  }

  currentUser = data.user;
  currentMeta = currentUser.user_metadata || {};

  authLink.textContent = 'Account';
  authLink.href = '/account';

  const plan = currentMeta.plan || 'Free';
  const searches = currentMeta.searches_remaining ??
    (plan === 'Starter' ? 100 :
     plan === 'Pro' ? 500 :
     plan === 'Enterprise' ? 2500 : 5);

  const reveals = currentMeta.reveals_remaining ??
    (plan === 'Starter' ? 50 :
     plan === 'Pro' ? 250 :
     plan === 'Enterprise' ? 1500 : 3);

  document.getElementById('plansButton').style.display = plan === 'Free' ? 'inline-flex' : 'none';
  document.getElementById('accountButton').style.display = 'inline-flex';
  document.getElementById('upgradeButton').style.display = plan === 'Enterprise' ? 'none' : 'inline-flex';

  const banner = document.getElementById('creditsBanner');
  banner.style.display = 'block';
  banner.innerHTML = `Plan: <b>${plan}</b> · Searches left: <b>${searches}</b> · Reveals left: <b>${reveals}</b>`;

  currentMeta.plan = plan;
  currentMeta.searches_remaining = searches;
  currentMeta.reveals_remaining = reveals;
}

async function updateCredits(newSearches, newReveals) {
  if (!currentUser) return;

  const { data } = await client.auth.updateUser({
    data: { ...currentMeta, searches_remaining: newSearches, reveals_remaining: newReveals }
  });

  if (data && data.user) {
    currentUser = data.user;
    currentMeta = currentUser.user_metadata || currentMeta;
  }

  document.getElementById('creditsBanner').innerHTML =
    `Plan: <b>${currentMeta.plan}</b> · Searches left: <b>${currentMeta.searches_remaining}</b> · Reveals left: <b>${currentMeta.reveals_remaining}</b>`;
}

function renderSingleResult(e, container, domain) {
  const fullEmail = e.value || '';
  const name = [e.first_name, e.last_name].filter(Boolean).join(' ') || 'Unknown';
  const role = e.position || 'No title';
  const masked = fullEmail.replace(/(.{2}).+(@.*)/, '$1*****$2');

  const card = document.createElement('div');
  card.className = 'result-card';

  const nameEl = document.createElement('div');
  nameEl.className = 'result-name';
  nameEl.textContent = name;

  const roleEl = document.createElement('div');
  roleEl.className = 'result-role';
  roleEl.textContent = role;

  const confEl = document.createElement('div');
  confEl.className = 'result-role';
  confEl.textContent = `${e.confidence}% confidence`;

  const emailEl = document.createElement('div');
  emailEl.className = 'result-email';
  emailEl.textContent = masked;

  const actions = document.createElement('div');
  actions.style.marginTop = '10px';

  const revealBtn = document.createElement('button');
  revealBtn.className = 'secondary-btn';
  revealBtn.textContent = 'Reveal Email';

  const saveBtn = document.createElement('button');
  saveBtn.className = 'secondary-btn';
  saveBtn.textContent = 'Save Email';
  saveBtn.disabled = true;

  revealBtn.onclick = async () => {
    if (!currentUser) return alert('Log in to reveal emails.');
    if (currentMeta.reveals_remaining <= 0) return alert('No reveals left.');

    await updateCredits(currentMeta.searches_remaining, currentMeta.reveals_remaining - 1);

    emailEl.textContent = fullEmail;
    revealBtn.disabled = true;
    revealBtn.textContent = 'Revealed';
    saveBtn.disabled = false;
  };

  saveBtn.onclick = async () => {
    if (!currentUser) return alert('Log in to save contacts.');
    if (saveBtn.disabled) return;

    const { data } = await client.auth.getUser();
    if (data && data.user) {
      currentUser = data.user;
      currentMeta = currentUser.user_metadata || currentMeta;
    }

    const saved = (currentMeta.saved_contacts || []).slice();
    saved.push({
      email: fullEmail,
      name,
      role,
      domain,
      saved_at: new Date().toISOString()
    });

    const { data: updated } = await client.auth.updateUser({
      data: { ...currentMeta, saved_contacts: saved }
    });

    if (updated && updated.user) {
      currentUser = updated.user;
      currentMeta = updated.user.user_metadata || currentMeta;
    }

    saveBtn.textContent = 'Saved';
    saveBtn.disabled = true;
  };

  const sourceBtn = document.createElement('button');
  sourceBtn.className = 'secondary-btn';
  sourceBtn.textContent = 'Source';
  sourceBtn.onclick = () => {
    if (!currentUser) return alert('Log in to view sources.');
    const q = encodeURIComponent(`${name} ${domain}`);
    window.open(`https://www.google.com/search?q=${q}`, '_blank');
  };

  actions.appendChild(revealBtn);
  actions.appendChild(saveBtn);
  actions.appendChild(sourceBtn);

  card.appendChild(nameEl);
  card.appendChild(roleEl);
  card.appendChild(confEl);
  card.appendChild(emailEl);
  card.appendChild(actions);

  container.appendChild(card);
}
function renderResults(emails, domain) {
  const container = document.getElementById('results');
  container.innerHTML = '';

  const groups = {};
  emails.forEach(e => {
    let dept = e.department || 'Department unknown';
    dept = dept.charAt(0).toUpperCase() + dept.slice(1);
    if (!groups[dept]) groups[dept] = [];
    groups[dept].push(e);
  });

  const sortedDepts = Object.keys(groups).sort((a, b) => {
    const indexA = deptOrder.indexOf(a);
    const indexB = deptOrder.indexOf(b);
    if (indexA === -1) return 1;
    if (indexB === -1) return -1;
    return indexA - indexB;
  });

  let first = true;

  sortedDepts.forEach(dept => {
    const deptDiv = document.createElement('div');
    deptDiv.className = 'dept-section';

    const header = document.createElement('div');
    header.className = 'dept-header';
    header.innerHTML = `
      <span class="dept-name">${dept}</span>
      <span class="dept-count">(${groups[dept].length})</span>
      <span class="dept-arrow">${first ? '▲' : '▼'}</span>
    `;

    const content = document.createElement('div');
    content.className = 'dept-content';
    if (first) content.classList.add('open');
    first = false;

    groups[dept].forEach(e => renderSingleResult(e, content, domain));

    header.onclick = () => {
      content.classList.toggle('open');
      const arrow = header.querySelector('.dept-arrow');
      arrow.textContent = content.classList.contains('open') ? '▲' : '▼';
    };

    deptDiv.appendChild(header);
    deptDiv.appendChild(content);
    container.appendChild(deptDiv);
  });

  container.style.display = 'block';
}

async function loadMore() {
  if (!currentUser) {
    alert('Sign up or log in to load more results.');
    return;
  }

  offset += PAGE_SIZE;

  const resp = await fetch(
    `https://api.hunter.io/v2/domain-search?domain=${encodeURIComponent(currentDomain)}&offset=${offset}&limit=${PAGE_SIZE}&api_key=${HUNTER_API_KEY}`
  );

  const data = await resp.json();
  const emails = data.data?.emails || [];

  renderResults(emails, currentDomain);

  const shown = document.querySelectorAll('.result-card').length;
  document.getElementById('statusMsg').textContent = `Showing ${shown} of ${totalResults} contacts`;

  if (shown >= totalResults || !emails.length) {
    document.getElementById('loadMoreBtn').style.display = 'none';
  }
}

document.getElementById('loadMoreBtn').addEventListener('click', loadMore);

document.getElementById('searchForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  const domain = document.getElementById('domainInput').value.trim();
  const status = document.getElementById('statusMsg');
  const results = document.getElementById('results');
  const shimmer = document.getElementById('shimmerLoader');

  currentDomain = domain;
  offset = 0;

  status.textContent = 'Searching...';

  results.style.display = 'none';
  results.innerHTML = '';
  shimmer.style.display = 'block';

  document.getElementById('loadMoreBtn').style.display = 'none';

  if (currentUser) {
    if (currentMeta.searches_remaining <= 0) {
      status.textContent = 'No searches left.';
      shimmer.style.display = 'none';
      return;
    }
    await updateCredits(currentMeta.searches_remaining - 1, currentMeta.reveals_remaining);
  }

  const resp = await fetch(
    `https://api.hunter.io/v2/domain-search?domain=${encodeURIComponent(domain)}&offset=0&limit=${PAGE_SIZE}&api_key=${HUNTER_API_KEY}`
  );

  const data = await resp.json();
  const emails = data.data?.emails || [];

  totalResults = data.meta?.results || emails.length;
  const shown = emails.length;

  shimmer.style.display = 'none';
  status.textContent = `Showing ${shown} of ${totalResults} contacts`;

  renderResults(emails, domain);
  showToast();

  if (shown < totalResults) {
    document.getElementById('loadMoreBtn').style.display = 'block';
  }
});

refreshUser();
</script>

<!-- FOOTER -->
<footer style="
  text-align:center;
  padding: 40px 0;
  font-size: 14px;
  color: var(--text-muted);
  margin-top: 60px;
">
  © 2026 NovaHunt.ai —
  <a href="mailto:hello@novahunt.ai" style="color:var(--text-muted); text-decoration:none;">
    Contact
  </a>
</footer>

<!-- AOS JS -->
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
  AOS.init({
    duration: 900,
    easing: 'ease-out-quart',
    once: true
  });
</script>

<!-- Statcounter -->
<script type="text/javascript">
var sc_project=13194804;
var sc_invisible=1;
var sc_security="d9cb3a26";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>
<noscript><div class="statcounter"><a title="web stats"
href="https://statcounter.com/" target="_blank"><img
class="statcounter"
src="https://c.statcounter.com/13194804/0/d9cb3a26/1/"
alt="web stats"
referrerPolicy="no-referrer-when-downgrade"></a></div></noscript>

</body>
</html>
